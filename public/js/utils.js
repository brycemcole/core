const stateMappings = {
  Alabama: 'AL',
  Alaska: 'AK',
  Arizona: 'AZ',
  Arkansas: 'AR',
  California: 'CA',
  Colorado: 'CO',
  Connecticut: 'CT',
  Delaware: 'DE',
  Florida: 'FL',
  Georgia: 'GA',
  Hawaii: 'HI',
  Idaho: 'ID',
  Illinois: 'IL',
  Indiana: 'IN',
  Iowa: 'IA',
  Kansas: 'KS',
  Kentucky: 'KY',
  Louisiana: 'LA',
  Maine: 'ME',
  Maryland: 'MD',
  Massachusetts: 'MA',
  Michigan: 'MI',
  Minnesota: 'MN',
  Mississippi: 'MS',
  Missouri: 'MO',
  Montana: 'MT',
  Nebraska: 'NE',
  Nevada: 'NV',
  'New Hampshire': 'NH',
  'New Jersey': 'NJ',
  'New Mexico': 'NM',
  'New York': 'NY',
  'North Carolina': 'NC',
  'North Dakota': 'ND',
  Ohio: 'OH',
  Oklahoma: 'OK',
  Oregon: 'OR',
  Pennsylvania: 'PA',
  'Rhode Island': 'RI',
  'South Carolina': 'SC',
  'South Dakota': 'SD',
  Tennessee: 'TN',
  Texas: 'TX',
  Utah: 'UT',
  Vermont: 'VT',
  Virginia: 'VA',
  Washington: 'WA',
  'West Virginia': 'WV',
  Wisconsin: 'WI',
  Wyoming: 'WY',
  'United States': 'US',
};

const countryMappings = {
  'United States': 'USA',
  'United Kingdom': 'UK',
  'Canada': 'CAN',
  'Australia': 'AUS',
  'Germany': 'DEU',
  'France': 'FRA',
  'Japan': 'JPN',
  'China': 'CHN',
  'India': 'IND',
  'Brazil': 'BRA',
  'Russia': 'RUS',
  'South Korea': 'KOR',
  'Italy': 'ITA',
  'Spain': 'ESP',
  'Mexico': 'MEX',
  'Netherlands': 'NLD',
  'Saudi Arabia': 'SAU',
  'Turkey': 'TUR',
  'Switzerland': 'CHE',
  'Argentina': 'ARG',
  'South Africa': 'ZAF',
  'Sweden': 'SWE',
  'Belgium': 'BEL',
  'Norway': 'NOR',
  'Austria': 'AUT',
  'Denmark': 'DNK',
  'Finland': 'FIN',
  'Greece': 'GRC',
  'Ireland': 'IRL',
  'Portugal': 'PRT',
  'Poland': 'POL',
  'Czech Republic': 'CZE',
  'Hungary': 'HUN',
  'New Zealand': 'NZL',
  'Singapore': 'SGP',
  'Malaysia': 'MYS',
  'Philippines': 'PHL',
  'Thailand': 'THA',
  'Indonesia': 'IDN',
  'Vietnam': 'VNM',
  'Israel': 'ISR',
  'United Arab Emirates': 'ARE',
  'Chile': 'CHL',
  'Colombia': 'COL',
  'Peru': 'PER',
  'Pakistan': 'PAK',
  'Bangladesh': 'BGD',
  'Nigeria': 'NGA',
  'Egypt': 'EGY',
  'Ukraine': 'UKR',
  'Romania': 'ROU',
  'Kazakhstan': 'KAZ',
  'Qatar': 'QAT',
  'Kuwait': 'KWT',
  'Bulgaria': 'BGR',
  'Croatia': 'HRV',
  'Lithuania': 'LTU',
  'Slovakia': 'SVK',
  'Slovenia': 'SVN',
  'Latvia': 'LVA',
  'Estonia': 'EST',
  'Luxembourg': 'LUX',
  'Iceland': 'ISL',
  'Malta': 'MLT',
  'Cyprus': 'CYP',
  'Serbia': 'SRB',
  'Montenegro': 'MNE',
  'North Macedonia': 'MKD',
  'Bosnia and Herzegovina': 'BIH',
  'Albania': 'ALB',
  'Georgia': 'GEO',
  'Armenia': 'ARM',
  'Azerbaijan': 'AZE',
  'Belarus': 'BLR',
  'Moldova': 'MDA',
  'Uzbekistan': 'UZB',
  'Turkmenistan': 'TKM',
  'Kyrgyzstan': 'KGZ',
  'Tajikistan': 'TJK',
  'Morocco': 'MAR',
  'Tunisia': 'TUN',
  'Algeria': 'DZA',
  'Libya': 'LBY',
  'Sudan': 'SDN',
  'Ethiopia': 'ETH',
  'Kenya': 'KEN',
  'Uganda': 'UGA',
  'Tanzania': 'TZA',
  'Ghana': 'GHA',
  'Ivory Coast': 'CIV',
  'Cameroon': 'CMR',
  'Senegal': 'SEN',
  'Zimbabwe': 'ZWE',
  'Zambia': 'ZMB',
  'Angola': 'AGO',
  'Mozambique': 'MOZ',
  'Namibia': 'NAM',
  'Botswana': 'BWA',
  'Malawi': 'MWI',
  'Rwanda': 'RWA',
  'Burundi': 'BDI',
  'Mauritius': 'MUS',
  'Madagascar': 'MDG',
  'Seychelles': 'SYC',
  'Lesotho': 'LSO',
  'Eswatini': 'SWZ',
  'Comoros': 'COM',
  'Djibouti': 'DJI',
  'Eritrea': 'ERI',
  'Somalia': 'SOM',
  'Hong Kong': 'HK',
  'Guatemala': 'GTM',
  'Gabon': 'GAB',
  'Equatorial Guinea': 'GNQ',
  'Central African Republic': 'CAF',
  'Chad': 'TCD',
  'Niger': 'NER',
  'Mali': 'MLI',
  'Burkina Faso': 'BFA',
  'Benin': 'BEN',
  'Togo': 'TGO',
  'Sierra Leone': 'SLE',
  'Liberia': 'LBR',
  'Guinea': 'GIN',
  'Guinea-Bissau': 'GNB',
  'Gambia': 'GMB',
  'Cape Verde': 'CPV',
  'Mauritania': 'MRT',
  'Western Sahara': 'ESH',
  'Palestine': 'PSE',
  'Lebanon': 'LBN',
  'Jordan': 'JOR',
  'Syria': 'SYR',
  'Iraq': 'IRQ',
  'Yemen': 'YEM',
  'Oman': 'OMN',
  'Bahrain': 'BHR',
  'Sri Lanka': 'LKA',
  'Nepal': 'NPL',
  'Bhutan': 'BTN',
  'Maldives': 'MDV',
  'Myanmar': 'MMR',
  'Laos': 'LAO',
  'Cambodia': 'KHM',
  'Brunei': 'BRN',
  'East Timor': 'TLS',
  'Papua New Guinea': 'PNG',
  'Fiji': 'FJI',
  'Samoa': 'WSM',
  'Tonga': 'TON',
  'Vanuatu': 'VUT',
  'Solomon Islands': 'SLB',
  'Micronesia': 'FSM',
  'Marshall Islands': 'MHL',
  'Palau': 'PLW',
  'Kiribati': 'KIR',
  'Nauru': 'NRU',
  'Tuvalu': 'TUV',
  // Add more countries as needed
};

function formatLocation(location) {
    if (!location) return "";

    const parts = location.split(',').map(part => part.trim());

    // Helper function to check if a string is a US state
    const isUSState = (str) => Object.keys(stateMappings).includes(str) || Object.values(stateMappings).includes(str);

    // Helper function to get state abbreviation
    const getStateAbbr = (state) => {
      const fullName = Object.keys(stateMappings).find(key => key.toLowerCase() === state.toLowerCase());
      return fullName ? stateMappings[fullName] : state;
    };

    if (parts.length === 1) {
      return parts[0];
    } else if (parts.length === 2) {
      if (isUSState(parts[1])) {
        return getStateAbbr(parts[1]);
      } else {
        return parts[1]; // Assume it's a non-US country
      }
    } else if (parts.length >= 3) {
      if (parts[2].trim().toLowerCase() === 'united states') {
        return getStateAbbr(parts[1]);
      } else {
        return parts[2]; // Return the country for non-US locations
      }
    }

    return location.trim();
  }

  